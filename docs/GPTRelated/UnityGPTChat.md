---
icon: material/message-settings-outline
---
# Unity GPT Test

 Try some interesting things with Unity and GPT, and most importantly: Learning!

```
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
:â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—:
:â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘:
:â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘:
:â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•      â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘:
:â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘:
:â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•        â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•:
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
```

# ä»‹ç»

Unityé¡¹ç›®æ–‡ä»¶åœ¨ï¼š[Lizhenghe-Chen/Unity-GPT-Test](https://github.com/Lizhenghe-Chen/Unity-GPT-Test){ .md-button }


å¹³å°æ”¯æŒï¼ˆæœªæµ‹è¯•åˆ™ç•™ç©ºï¼‰ï¼š

| Architecture | Android | iOS | Windows | macOS | linux | HarmonyOS | WebGL |
| ------------ | ------- | --- | ------- | ----- | ----- | --------- | ----- |
|              | âœ…      |     | âœ…      |       |       |           | ğŸš«    |

AI+æ¸¸æˆææ€•åœ¨æ‰€éš¾å…ï¼Œè™½ç„¶ç°åœ¨æ²¡æœ‰æˆç†Ÿçš„æŠ€æœ¯å’Œè§£å†³æ–¹æ¡ˆæ¥æ—¶é—´GPTå’Œæ¸¸æˆçš„æ·±åº¦èåˆï¼Œä½†æ˜¯æ¢ç´¢çš„è„šæ­¥æ— æ³•é˜»æŒ¡ï¼Œæ‰€ä»¥å°è¯•ç”¨ç›¸å¯¹ç®€å•çš„æ–¹å¼å®ç°Unity+GPTçš„ä¸€äº›åŠŸèƒ½ï¼š

* [X] åœ¨Untiyå†…å®ç°å’ŒChatGPTæˆ–æœ¬åœ°å¤§æ¨¡å‹çš„æ–‡å­—å¯¹è¯
* [X] åœ¨Untiyå†…å®ç°å’ŒChatGPTæˆ–æœ¬åœ°å¤§æ¨¡å‹çš„æ–‡å­—å¯¹è¯+å®ç°è¯­éŸ³äº¤æµ
* [X] å®ç°GPTæ§åˆ¶æ¸¸æˆå†…åœºæ™¯
* [ ] æ•°å­—äººï¼ˆåŠ¨ä½œã€è¡¨æƒ…ã€å”‡åŠ¨ã€TTSå’ŒSTTï¼‰
* [ ] GPTæ§åˆ¶æ¸¸æˆå†…è§’è‰²è¡ŒåŠ¨
* [ ] ã€‚ã€‚ã€‚

# éƒ¨ç½²GPT

## æ¥å£è§„èŒƒ

è¿™é‡Œä½¿ç”¨ [OpenAI API chat çš„ç»Ÿä¸€è§„èŒƒæ ¼å¼][https://platform.openai.com/docs/api-reference/chat/create)ï¼Œå¤§éƒ¨åˆ†æ¨¡å‹å’Œå¹³å°éƒ½æœ‰è¿™ä¸ªæ¥å£è§„èŒƒçš„ï¼š

é€šè¿‡POSTçš„æ–¹å¼å‘é€è§„èŒƒçš„Jsonæ ¼å¼è¯·æ±‚åˆ°æŒ‡å®šæœåŠ¡å™¨ï¼Œå¹¶æ¥å—è¿”å›çš„ç»“æœå³å¯

jsonæ ¼å¼ï¼š

```json
curl https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -d '{
    "model": "gpt-4o",
    "messages": [
      {
        "role": "system",
        "content": "You are a helpful assistant."
      },
      {
        "role": "user",
        "content": "Hello!"
      }
    ]
  }'

```

**ä»»ä½•æ—¶å€™éƒ½éœ€è¦ï¼š**

* urlï¼šæœåŠ¡å™¨åœ°å€
* modelï¼šæ¨¡å‹åå­—
* messagesï¼šå‘é€çš„è¯·æ±‚ç±»å‹å’Œå†…å®¹ï¼š

  * **`system`** ï¼š

    * **ä½œç”¨** ï¼š System è§’è‰²ç”¨äºæä¾›é€šçŸ¥æ¨¡å‹è¡Œä¸ºçš„è®¾ç½®ä¿¡æ¯æˆ–ä¸Šä¸‹æ–‡ã€‚è¿™å¯èƒ½åŒ…æ‹¬æœ‰å…³å¯¹è¯åº”å¦‚ä½•è¿›è¡Œçš„è¯´æ˜æˆ–æŒ‡å—ã€‚
    * **ä½•æ—¶ä½¿ç”¨** ï¼šæ‚¨å¯ä»¥ä½¿ç”¨æ­¤è§’è‰²ä¸ºäº¤äº’è®¾ç½®é˜¶æ®µã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¸Œæœ›æ¨¡å‹åœ¨æ•´ä¸ªå¯¹è¯ä¸­ä¿æŒæ­£å¼çš„è¯­æ°”ï¼Œæˆ–è€…å¦‚æœæ‚¨éœ€è¦æŒ‡å®šè§„åˆ™ï¼ˆä¾‹å¦‚é¿å…æŸäº›è¯é¢˜ï¼‰ã€‚
  * **`user`**ï¼š

    * **ä½œç”¨** ï¼š æ­¤è§’è‰²ä»£è¡¨å¯¹è¯ä¸­çš„äººç±»ç”¨æˆ·ã€‚æ¥è‡ªç”¨æˆ·çš„è¾“å…¥å°†æŒ‡å¯¼å¯¹è¯å¹¶æç¤ºåŠ©æ‰‹çš„å“åº”ã€‚
    * **ä½•æ—¶ä½¿ç”¨** ï¼šæ¯å½“äººç±»ç”¨æˆ·å‘è¡¨å£°æ˜æˆ–æå‡ºé—®é¢˜æ—¶ã€‚è¿™æ˜¯æ ‡å‡†äº¤äº’ä¸­æœ€å¸¸ç”¨çš„è§’è‰²ã€‚
  * **`agent`** ï¼š

    * **åŠŸèƒ½ç®€ä»‹** ï¼šè¿™æ˜¯æ¨¡å‹æœ¬èº«çš„ä½œç”¨ï¼Œæ ¹æ®ç³»ç»Ÿè®¾ç½®çš„ä¸Šä¸‹æ–‡å“åº”ç”¨æˆ·è¾“å…¥ã€‚
  * * **ä½•æ—¶ä½¿ç”¨** ï¼šå½“æ¨¡å‹å›å¤ç”¨æˆ·çš„æŸ¥è¯¢æˆ–éµå¾ªç³»ç»Ÿçš„æŒ‡ç¤ºæ—¶ï¼Œæ¨¡å‹ä¼šè‡ªåŠ¨ä»£å…¥æ­¤è§’è‰²ã€‚

## å¤§è¯­è¨€æ¨¡å‹å¹³å°ï¼ˆLLMï¼‰

ä»¥ä¸‹ä»»æ„ä¸€ç§å¹³å°å‡å¯ä½¿ç”¨ç»Ÿä¸€çš„OpenAIè§„èŒƒæ¥å£ï¼Œæ‰€ä»¥éƒ½åªç”¨æ›´æ”¹ç½‘å€ã€API Keyå’Œmodelåç§°å³å¯ï¼

* å¦‚æœä½ ä½¿ç”¨ChatGPTï¼Œé‚£ä¹ˆå°±å¾ˆç®€å•äº†ï¼Œç›´æ¥ç”¨ä¸Šé¢çš„æ¥å£æ ¼å¼å°±è¡Œï¼Œåªéœ€è¦API key å’Œæ¨¡å‹åç§°å³å¯ï¼šå¦‚åœ¨æ§åˆ¶å°ä¸­è¾“å…¥ï¼š`ollama run qwen2.5` å³å¯ä¸‹è½½è¿è¡Œåƒé—®å¤§æ¨¡å‹
* å¦‚æœä½¿ç”¨Ollamaéƒ¨ç½²æœ¬åœ°å¤§æ¨¡å‹ï¼š

  * åŒæ ·å¯ä»¥ä½¿ç”¨Open AIè§„èŒƒçš„å½¢å¼ï¼Œå‚è€ƒï¼š[OpenAI compatibility Â· Ollama Blog][https://ollama.com/blog/openai-compatibility)
  * åªè¦ä¸‹è½½å¹¶éƒ¨ç½²å¥½Ollamaå¹¶å®‰è£…å¥½æŒ‡å®šçš„æ¨¡å‹å³å¯
  * å¸¸ç”¨çš„Ollamaç¯å¢ƒå˜é‡è®¾ç½®ï¼ˆ[Global Configuration Variables for Ollama][OllamaGlobalConfiguration.md)ï¼‰ï¼š
    * `OLLAMA_ORIGINS`: å…è®¸çš„æ¥æºï¼Œç”¨äºè·¨åŸŸè¯·æ±‚ï¼Œå¦‚æœé‡åˆ°ï¼ˆCORSï¼‰é—®é¢˜ï¼Œå¯ä»¥è®¾ç½®å˜é‡ä¸º `*`
    * `OLLAMA_MODELS`: æŒ‡å®šæ¨¡å‹ä¸‹è½½å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯ `$HOME/.ollama/models`
    * `OLLAMA_HOST`: æœåŠ¡å™¨ç«¯å£åœ°å€ï¼Œé»˜è®¤æ˜¯ `http://127.0.0.1:11434`
    * `OLLAMA_KEEP_ALIVE`: æ¨¡å‹æ¿€æ´»åçš„ä¿æŒæ—¶é—´ï¼Œé»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œè¿™ä¼šåœ¨åŠ è½½å¤§ä½“é‡æ¨¡å‹ä½†å¸¸ç”¨çš„æ—¶å€™æ¯ä¸€æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°åŠ è½½æ¨¡å‹ï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒé•¿çš„æ—¶é—´å¦‚5h
* å¦‚æœä½¿ç”¨AnythingLLMæ­å»ºæœ¬åœ°çŸ¥è¯†åº“

  * ç¡®ä¿Ollamaå·²ç»å®‰è£…
  * ä¸‹è½½å®‰è£…[Download AnythingLLM for Desktop][https://anythingllm.com/download)
  * ç„¶åç®€å•çš„é…ç½®å¥½ï¼ŒæŒ‡å®šOllamaä¸ºå†…æ ¸å³å¯
  * ä¸ºäº†èƒ½å¤ŸåƒOpenAIé‚£æ ·ä½¿ç”¨ç½‘ç»œAPIæ¥å£ï¼Œåœ¨ è®¾ç½®>å·¥å…·>APIå¯†é’¥ é‡Œç”³è¯·ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åç‚¹å‡»â€œé˜…è¯»APIæ–‡æ¡£â€ï¼Œç‚¹å‡»â€œAuthorizeâ€å°†å¯†é’¥å¤åˆ¶è¿›å»å°±å¯ä»¥æµ‹è¯•æ¥å£äº†ï¼š
  * åœ¨ä½ åˆ›å»ºå®Œä¸€ä¸ªworkspaceåï¼Œå°±å¯ä»¥æŸ¥é˜…æ¨¡å‹åç§°ï¼š
    * ![1729750316805][image/README/1729750316805.png "æŸ¥é˜…å½“å‰å¯è¿è¡Œæ¨¡å‹åç§°")
  * å°†æŸ¥é˜…çš„æ¨¡å‹åç§°è¾“å…¥åˆ°èŠå¤©APIä¸­æµ‹è¯•ï¼š	![1729750515274][image/README/1729750515274.png)
  * ä¹‹åä½ åªéœ€è¦å°†ä¸Šè¿°ç‰¹å®šçš„jsonæ•°æ®è¯·æ±‚æ ¼å¼å‘é€åˆ°ï¼š

  ```bash
  http://localhost:3001/api/v1/openai/chat/completions
  ```

## ç„¶åå°±æ˜¯Unity C#ä»£ç çš„ç®€å•è§£æï¼š

### å¤„ç†å‘é€ä¿¡æ¯

è¿™ä¸ªè¿æ¥å¯ä»¥å¸®åŠ©ä½ ç†è§£ï¼š[èŠå¤©æ¥å£ /v1/chat/completions - API2D][https://api2d-doc.apifox.cn/)

ä¸ºäº†é€šè¿‡è§„èŒƒä¸”æ•´æ´çš„æ–¹å¼ç”Ÿæˆjsonä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡åˆ›å»ºC# Classçš„Objectå¹¶é€šè¿‡Newtonsoft. Jsonå¼ºåˆ¶è½¬æ¢ä¸ºjsonæ ¼å¼:JsonConvert.SerializeObject())

```csharp
private SimpleOpenAIRequest SetupSimpleRequest()
{
    var userRequest = new SimpleOpenAIRequest
{
        Model = config.modelSettings.model,
        Stream = config.modelSettings.useStream,
        Temperature = config.modelSettings.temperature,
        Messages = new List<Message>()
    };

    return userRequest;
}
```

```csharp
var jsonString = JsonConvert.SerializeObject(_simpleOpenAIRequest).ToLower();
```

**å…·ä½“çš„æ•°æ®ç»“æ„è®¾ç½®åœ¨è„šæœ¬ï¼š[ SimpleOpenAIRequest.cs][Assets/GPTModule/Scripts/OpenAIChatGPT.cs)
ç„¶åç”Ÿæˆçš„å…·ä½“è„šæœ¬åœ¨ï¼š[ OpenAIChatGPT.cs][Assets/GPTModule/Scripts/OpenAIChatGPT.cs)**

ç½‘ç»œåè®®çš„è¯·æ±‚æ ¼å¼ï¼š

```csharp
/// <summary>
        ///  ç”ŸæˆOpenAIè¯·æ±‚
        /// </summary>
        /// <returns> è¿”å›ä¸€ä¸ªUnityWebRequestå¯¹è±¡ </returns>
        private UnityWebRequest GenerateOpenAIRequest()
        {
            //convert the data to JSONï¼Œæ³¨æ„è¿™é‡Œçš„ToLower()ï¼Œå› ä¸ºOpenAIçš„APIå¯¹å¤§å°å†™æ•æ„Ÿï¼Œå¦‚æœClassçš„å±æ€§åæ˜¯å¤§å†™ï¼Œä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥
            var jsonString = JsonConvert.SerializeObject(_simpleOpenAIRequest).ToLower();
            var request = new UnityWebRequest(config.url, "POST");
            var bodyRaw = System.Text.Encoding.UTF8.GetBytes(jsonString);
            request.uploadHandler = new UploadHandlerRaw(bodyRaw);
            request.downloadHandler = new DownloadHandlerBuffer();
            request.SetRequestHeader("Content-Type", "application/json");
            request.SetRequestHeader("Authorization", "Bearer " + config.apiKey);
            request.certificateHandler = new ChatGptWebRequestCert();
            Debug.Log("<color=orange>Request: </color>" + jsonString);
            onSend.Invoke(); // Event to show that the request is being sent
            return request;
        }
```

### å¤„ç†æ¥å—ä¿¡æ¯

gptçš„å›è°ƒä¹Ÿæ˜¯Jsonå½¢å¼ï¼ŒåŒæ ·å¯ä»¥æŠŠä»–ä»¬å†è½¬ä¼šC#çš„æ•°æ®æ ¼å¼

æ‰€ä»¥æœ€åçš„æ”¶å‘æ ¸å¿ƒä»£ç ä¸ºï¼š

```csharp
 /// <summary>
        /// <param name="prompt"> The text to send to the GPT model </param>
        /// <param name="callback"> The callback function to be called when the response is received,
        /// leave it null if you don't need a callback </param>
        /// <returns></returns>  
        /// </summary>
        private IEnumerator GetChatGptResponse(string prompt, Action<string> callback = null)
        {
            SetUserRequest(prompt);

            var request = GenerateOpenAIRequest();

            yield return request.SendWebRequest();

            if (request.result is UnityWebRequest.Result.ConnectionError or UnityWebRequest.Result.ProtocolError)
            {
                Debug.LogError("Error: " + request.error);
            }
            else
            {
                Debug.Log("<color=green>Respond: </color>" + request.downloadHandler.text);
                var responseText = request.downloadHandler.text;
                //Debug.Log("Response: " + responseText);
                // Parse the JSON response to extract the required parts
                var response = JsonConvert.DeserializeObject<OpenAIResponse>(responseText);
                callback?.Invoke(response.Choices[0].Message.Content);
                latestResult = response.Choices[0].Message.Content;
                onTextUpdate.Invoke();
                onComplete.Invoke();
            }
        }

```

**å…·ä½“ç»†èŠ‚è¿˜è¯·å‚è€ƒï¼š[OpenAIChatGPT.cs][Assets/GPTModule/Scripts/OpenAIChatGPT.cs)**

# Unityä¸­é…ç½®ï¼š

**GPTç›¸å…³çš„é…ç½®è®¾ç½®éƒ½æ”¾åœ¨[ GPTConfig.cs][Assets/GPTModule/Scripts/GptModuleConfig.cs)ä¸­ï¼Œè¿™ä¸ªç±»ä¸»è¦æ˜¯ç”¨æ¥è®¾ç½®GPTçš„ä¸€äº›å‚æ•°ï¼Œå¦‚API Keyã€æ¨¡å‹åç§°ã€è¯·æ±‚åœ°å€ç­‰ç­‰ï¼Œåœ¨Unityinspectorä¸­é™„åœ¨[ OpenAIChatGPT.cs][Assets/GPTModule/Scripts/OpenAIChatGPT.cs)ç»„ä»¶ç‰©ä½“ä¸Š:**

![1729752645787][image/README/1729752645787.png)
